<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content />
        <meta name="author" content />
        <title>Class DFormHelper - uim framework</title>
        <link rel="icon" type="image/x-icon"
            href="https://uimsolutions.github.io/uim/assets/favicon.ico" />
        <link href="https://uimsolutions.github.io/uim/css/tabler.min.css" rel="stylesheet" />
    </head>
    <body>
        <div class="page">
            <header class="navbar navbar-expand-md d-print-none">
    <div class="container-xl">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbar-menu" aria-controls="navbar-menu"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div
            class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
            <a href=".">UIM FRAMEWORK
            </a>
        </div>
        <div class="navbar-nav flex-row order-md-last">
            <div class="nav-item d-none d-md-flex me-3">
                <div class="btn-list">
                    <a href="https://github.com/UIMSolutions/uim" class="btn"
                        target="_blank" rel="noreferrer">
                        Source code
                    </a>
                    <a href="https://www.patreon.com/sicherheitsschmiede/posts"
                        class="btn"
                        target="_blank" rel="noreferrer">
                        Sponsor
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>
<header class="navbar-expand-md">
    <div class="collapse navbar-collapse" id="navbar-menu">
        <div class="navbar">
            <div class="container-xl">
                <div class="row flex-fill align-items-center">
                    <div class="col">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="https://uimsolutions.github.io/uim">
                                    Home
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://uimsolutions.github.io/uim/api/interfaces">Interfaces</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://uimsolutions.github.io/uim//api/classes">Classes</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://uimsolutions.github.io/uim/api/libraries">Libraries</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="https://uimsolutions.github.io/uim/api/packages">Packages</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
            <div class="page-wrapper">
                <div class="page-header">
                    <div class="row align-items-center mw-100">
                        <div class="col">
                            <div class="container-xl">
                                <div class="page-pretitle">
                                    Class
                                </div>
                                <h2 class="page-title">
                                    DFormHelper
                                </h2>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="page-body">
                    <div class="col">
                        <div class="container-xl">
                            <div class="card">
        <div class="table-responsive">
            <table class="table card-table"><thead><tr><th>Name</th></tr></thead><tbody><tr><td>origin</td><td>C:\Users\ONS\PROJECTS2023\uim\views\uim\views\helpers\form.d</td></tr><tr><td>isFinal</td><td>false</td></tr><tr><td>package</td><td>uim.views.helpers</td></tr><tr><td>visibility</td><td>public</td></tr><tr><td>name</td><td>DFormHelper</td></tr><tr><td>isAbstract</td><td>false</td></tr><tr><td>namespace</td><td>uim.views.helpers.form</td></tr><tr><td>header</td><td>class DFormHelper : DHelper</td></tr><tr><td>methods</td><td>["    mixin(HelperThis!(\"Form\"));","     * `data` - Corresponds to request data (POST/PUT).","    override bool initialize(Json[string] initData = null) {","            .set(\"string\", \"text\")","            .set(\"text\", \"textarea\")","            .set(\"uuid\", \"string\")","            .set(\"datetime\", \"datetime\")","            .set(\"datetimefractional\", \"datetime\")","            .set(\"timestamp\", \"datetime\")","            .set(\"timestampfractional\", \"datetime\")","            .set(\"timestamptimezone\", \"datetime\")","            .set(\"date\", \"date\")","            .set(\"time\", \"time\")","            .set(\"year\", \"year\")","            .set(\"boolean\", \"checkbox\")","            .set(\"float\", \"number\")","            .set(\"integer\", \"number\")","            .set(\"tinyinteger\", \"number\")","            .set(\"smallinteger\", \"number\")","            .set(\"decimal\", \"number\")","            .set(\"binary\", \"file\");","            .set(\"button\", [\"Button\"])","            .set(\"checkbox\", [\"Checkbox\"])","            .set(\"file\", [\"File\"])","            .set(\"label\", [\"Label\"])","            .set(\"nestingLabel\", [\"NestingLabel\"])","            .set(\"multicheckbox\", [\"MultiCheckbox\", \"nestingLabel\"])","            .set(\"radio\", [\"Radio\", \"nestingLabel\"])","            .set(\"select\", [\"SelectBox\"])","            .set(\"textarea\", [\"Textarea\"])","            .set(\"datetime\", [\"DateTime\", \"select\"])","            .set(\"year\", [\"Year\", \"select\"])","            .set(\"_default\", [\"Basic\"]);","            .setDefault(\"idPrefix\", Json(null))","            .setDefault(\"errorClass\", \"form-error\")","            // .setDefault(\"typeMap\", typeMap)","            .setDefault(\"templates\", createMap!(string, Json)) // set HTML5 validation message to custom required/empty messages","            .setDefault(\"autoSetCustomValidity\", true);","            // mylocator = configuration.shift(\"locator\");","                configuration.set(\"widgets\", configuration.get(\"widgets\").toArray);","            // mywidgets = configuration.shift(\"widgets\").toArray ~ mywidgets;","            _groupedInputTypes = configuration.shift(\"groupedInputTypes\").toStringArray;","    const string SECURE_SKIP = \"skip\"; // Defines the type of form being created. Set by FormHelper.create().","    setWidgetLocator(mylocator);","    _idPrefix = configuration.getString(\"idPrefix\");","    DWidgetLocator getWidgetLocator() {","    void setWidgetLocator(DWidgetLocator myinstance) {","    DContextFactory contextFactory(DContextFactory factory = null, Json[string] contexts = null) {","            return _contextFactory ? _contextFactory : DContextFactory.createWithDefaults(contexts);","     * the form context\"s isCreate() method returns false, a PUT request will be done.","     * - `encoding` Set the accept-charset encoding for the form. Defaults to `configuration.get(\"App.encoding\")`","     * - `valueSources` The sources that values should be read from. See FormHelper.setValueSources()","    string create(Json formContext = null, Json[string] options = null) {","            context(formContext);","                options.set(\"context\", Json(null));","            options.set(\"context.entity\", formContext);","            formContext = _getContext(options.shift(\"context\"));","        myisCreate = formContext.isCreate();","            .merge(\"type\", myisCreate ? \"post\" : \"put\")","            .merge(\"url\", Json(null))","            .merge(\"encoding\", configuration.get(\"App.encoding\").lower)","            .merge(\"templates\", Json(null))","            .merge(\"idPrefix\", Json(null))","            .merge(\"valueSources\", Json(null));","            setValueSources(options.shift(\"valueSources\"));","            _idPrefix = options.get(\"idPrefix\");","        mytemplater = this.templater();","            mytemplater.push();","            methodName = isString(options.get(\"templates\")) ? \"load\" : \"add\";","        options.removeKey(\"templates\");","            myurl = _view.getRequest().getRequestTarget();","            myurl = _formUrl(formContext, options);","            myaction = _url.build(myurl);","        lastAction(myurl);","        options.removeKey(\"ur\", \"idPrefix\");","        switch (options.get(\"type\").lower) {","            myhtmlAttributes.get(\"method\", \"get\");","            myhtmlAttributes.get(\"enctype\", \"multipart/form-data\");","            options.set(\"type\", myisCreate ? \"post\" : \"put\");","                    \"value\": options.getString(\"type\").upper,","            myhtmlAttributes.get(\"method\", \"post\");","            myhtmlAttributes.set(\"method\", options.getString(\"method\").lower);","            myhtmlAttributes.set(\"enctype\", options.getString(\"enctype\").lower);","        _requestType = options.getString(\"type\").lower;","            myhtmlAttributes.set(\"accept-, set\", options.get(\"encoding\"));","        options.removeKey(\"type\", \"encoding\");","            myformTokenData = _view.getRequest().getAttribute(\"formTokenData\");","                _formProtector = this.createFormProtector(myformTokenData);","            myappend ~= _csrfField();","            myappend = mytemplater.format(\"hiddenBlock\", [\"content\": myappend]);","        myactionAttr = mytemplater.formatAttributes(createMap!(string, Json)","                .set(\"action\", myaction)","                .set(\"escape\", false));","        return _formatTemplate(\"formStart\", createMap!(string, Json)","                .set(\"attrs\", mytemplater.formatAttributes(myhtmlAttributes) ~ myactionAttr)","                .set(\"templateVars\", options.getArray(\"templateVars\"))) ~ myappend;","    protected string[] _formUrl(IContext formContext, Json[string] options = null) {","            return request.getRequestTarget();","            options.isString(\"url\") ||","            (options.isArray(\"url\") && options.hasKey(\"url._name\"))","            return options.get(\"url\");","        return options.get(\"url\")","            .merge(\"plugin\", _view.pluginName)","            .merge(\"controller\", request.getParam(\"controller\"))","    protected void lastAction(string[] myurl = null) {","        auto myQuery = parse_url(myaction, D_URL_QUERY);","    protected string _csrfField() {","        auto csrfToken = request.getAttribute(\"csrfToken\");","        return _hidden(\"_csrfToken\", createMap!(string, Json)","                .set(\"value\", csrfToken)","     * Closes an HTML form, cleans up values set by FormHelper.create(), and writes hidden","     * Resets some parts of the state, shared among multiple FormHelper.create() calls, to defaults.","    string end(Json[string] secureAttributes = null) {","            result ~= this.secure([], secureAttributes);","        result ~= formatTemplate(\"formEnd\", []);","        templater().pop();","        _idPrefix = configurationData.hasKey(\"idPrefix\");","    string secure(Json[string] fieldNames = null, Json[string] secureAttributes = null) {","            _formProtector.addField(fieldName, true, myvalue);","        auto mydebugSecurity = configuration.getBoolean(\"debug\");","            secureAttributes.removeKey(\"debugSecurity\");","           _getFormProtectorSessionId()","    protected string _getFormProtectorSessionId() {","        // return _view.getRequest().getSession().id();","    void unlockField(string fieldName) {","        getFormProtector().unlockField(fieldName);","    protected DFormProtector createFormProtector(Json[string] tokenData) {","        mysession.start();","    DFormProtector getFormProtector() {","                    \" in your controller and called `FormHelper.create()` before calling `FormHelper.unlockField()`.\"","    bool isFieldError(string fieldName) {","        return _getContext().hasError(fieldName);","    string error(string fieldName, string[] text = null, Json[string] options = null) {","            fieldName = subString(fieldName, 0, -5);","        options.merge(\"escape\", true);","        auto formContext = _getContext();","        auto myerror = formContext.error(fieldName);","            foreach (key, exception; myerror) {","            Json myerror = htmlAttributeEscape(myerror);","            options.removeKey(\"escape\");","                foreach (error; myerror) {","                    myerrorText ~= formatTemplate(\"errorItem\", [\"text\": error]);","                myerror = myerror.pop();","        return _formatTemplate(\"error\", createMap!(string, Json)","                .set(\"content\", myerror)","     * FormHelper._domId().","     * writeln(this.Form.label(\"published\");","     * writeln(this.Form.label(\"published\", \"Publish\");","     * \"input\": this.text(\"published\"),","    string label(string fieldName, string text = null, Json[string] htmlAttributes = null) {","                text = subString(text, 0, -5);","                string[] fieldNameElements = text.split(\".\");","                text = fieldNameElements.pop();","                text = subString(text, 0, -3);","            text = __(text.underscore.humanize);","            htmlAttributes.removeKey(\"for\");","            mylabelFor = _domId(fieldName);","            .set(\"for\", mylabelFor)","            .set(\"text\", text);","            return _widget(\"nestingLabel\", attributes);","     * this.Form.allControls([\"title\": false]);","    string allControls(Json[string] fieldNames = null, Json[string] options = null) {","        auto mymodelFields = mycontext.fieldNames();","        auto fieldNames = array_merge(mymodelFields, fieldNames);","    string controls(Json[string] fieldNames, Json[string] options = null) {","        foreach (views, myopts; fieldNames) {","    string fieldset(string fieldNames = \"\", Json[string] options = null) {","        auto fieldNameset = options.getBoolean(\"fieldset\", true);","        auto mycontext = _getContext();","            auto myisCreate = mycontext.isCreate();","            auto mymodelName = Inflector.singularize(_view.getRequest()","                    .getParam(\"controller\")).humanize;","                result = formatTemplate(\"legend\", [\"text\": isLegend]) ~ result;","                fieldNamesetParams[\"attrs\"] = this.templater().formatAttributes(fieldNameset);","            result = formatTemplate(\"fieldset\", fieldNamesetParams);","     * attributes or options for the different **type** methods can be included in `options` for control().","     * - `label` - Either a string label, or an array of options for the label. See FormHelper.label().","     * (field error and error messages).","    string control(string fieldName, Json[string] options = null) {","            .merge(\"type\", Json(null))","            .merge(\"label\", Json(null))","            .merge(\"error\", Json(null))","            .merge(\"required\", Json(null))","            .merge(\"options\", Json(null))","            .merge(\"templates\", Json.emptyArray)","            .merge(\"templateVars\", Json.emptyArray)","            .merge(\"options\", true);","        options = _parseOptions(fieldName, options);","        options.set(\"id\", _domId(fieldName));","        auto mytemplater = this.templater();","        auto mynewTemplates = options.get(\"templates\");","            mytemplater.push();","            mytemplateMethod = isString(options.getString(\"templates\") ? \"load\" : \"add\");","        options.removeKey(\"templates\");","            bool isFieldError = isFieldError(fieldName);","                .update(\"aria-required\", options.getBoolean(\"required\") ? \"true\" : null)","                .update(\"aria-invalid\", isFieldError ? \"true\" : null);","                options.update(\"aria-label\", options.get(\"placeholder\"));","            myError = options.isArray(\"error\")","                ? error(fieldName, options.get(\"error\"), options.get(\"error\")) : error(fieldName, options.get(","            options.removeKey(\"error\");","        auto mylabel = options.shift(\"label\");","        auto myoptions = options.shift(\"options\");","        bool isNestedInput = options.getString(\"type\") == \"checkbox\";","        isNestedInput = options.getBoolean(\"nestedInput\", isNestedInput);","        options.removeKey(\"nestedInput\");","            && options.getString(\"type\") == \"checkbox\"","            && !hasKey(\"hiddenField\", options)","            options.get(\"hiddenField\", \"_split\");","        string myinput = _getInput(fieldName, options ~ [\"options\": myoptions]);","                mytemplater.pop();","        auto mylabel = _getLabel(fieldName, compact(\"input\", \"label\", \"error\", \"nestedInput\").merge(","            ? _groupTemplate(compact(\"label\", \"error\", \"options\")) : _groupTemplate(","                compact(\"input\", \"label\", \"error\", \"options\"));","            mytemplater.pop();","    protected string _groupTemplate(Json[string] options = null) {","                \"input\": options.get(\"input\"),","                \"label\": options.get(\"label\"),","                \"error\": options.get(\"error\"),","                \"templateVars\": options.get(\"options.templateVars\"),","    protected string _inputContainerTemplate(Json[string] options = null) {","            \"options.type\") ~ \"Container\" ~ options.getString(\"errorSuffix\");","            myinputContainerTemplate = \"inputContainer\" ~ options.getString(\"errorSuffix\");","                \"content\": options.get(\"content\"),","                \"error\": options.get(\"error\"),","                \"label\": options.getString(\"label\", \"\"),","                \"required\": options.get(\"options.required\") ? \" \" ~ this.templater()","                .get(\"requiredClass\"): \"\",","                \"type\": options.get(\"options.type\"),","                \"templateVars\": options.get(\"options.templateVars\", null),","    protected string[] _getInput(string fieldName, Json[string] options = null) {","        auto mylabel = options.shift(\"options\");","        switch (options.getString(\"type\").lower) {","            auto myopts = options.shift(\"options\");","    protected Json[string] _parseOptions(string fieldName, Json[string] options = null) {","            options.set(\"type\", _inputType(fieldName, options));","        return _magicOptions(fieldName, options, myneedsMagicType);","    protected string _inputType(string fieldName, Json[string] options = null) {","        auto mycontext = _getContext();","        auto internalType = mycontext.type(fieldName);","        auto mymap = configuration.get(\"typeMap\");","        // auto fieldName = fieldName.split(\".\").slice(, -1)[0];","            options.hasKey(\"checked\"): \"checkbox\",","            options.hasKey(\"options\"): \"select\",","            isIn(fieldName, [\"passwd\", \"password\"], true): \"password\",","            isIn(fieldName, [\"tel\", \"telephone\", \"phone\"], true): \"tel\",","            options.hasKey(\"rows\") || options.hasKey(\"cols\") : \"textarea\",","    protected Json[string] _optionsOptions(string fieldName, Json[string] options = null) {","        auto internalType = _getContext().type(fieldName);","            mydbType = TypeFactory.build(internalType);","                    options.set(\"type\", \"select\");","                options.set(\"options\", this.enumOptions(mydbType.getEnumclassname()));","            fieldName = subString(fieldName, 0, -5);","            fieldName = subString(fieldName, 0, -3);","        fieldName = fieldName.split(\".\").slice(-1)[0];","            mypluralize ? Inflector.pluralize(fieldName) : fieldName","        myvarOptions = _view.get(myvarName);","            options.set(\"type\", \"select\");","        options.set(\"options\", myvarOptions);","    // TODO protected array<int|string, string> enumOptions(string enumclassname) {","        foreach (mycase; enumclassname.cases()) {","            myhasLabel = cast(IEnumLabel)mycase || hasMethod(mycase, \"label\");","            myvalues[mycase.value] = myhasLabel ? mycase.label(): mycase.name;","    protected Json[string] _magicOptions(string fieldName, Json[string] options, bool allowOverride) {","        options = setRequiredAndCustomValidity(fieldName, options);","        auto mymagicOptions = (isIn(options.get(\"type\"), [\"radio\", \"select\"], true) || allowOverride);","            options = _optionsOptions(fieldName, options);","            options.set(\"type\", \"select\");","                options.set(\"multiple\", true);","    protected Json[string] setRequiredAndCustomValidity(string fieldName, Json[string] options = null) {","            options.set(\"required\", mycontext.isRequired(fieldName));","        mymessage = mycontext.getRequiredMessage(fieldName);","        mymessage = htmlAttributeEscape(mymessage);","            options.set(\"templateVars.customValidityMessage\", mymessage);","                options.set(\"data-validity-message\", mymessage);","                    \"setCustomValidity(\\\"\\\"); \" ~","                options.set(\"oninput\", \"setCustomValidity(\\\"\\\")\");","    protected string _getLabel(string fieldName, Json[string] options = null) {","        auto mylabel = options.get(\"label\", null);","            return options.get(\"input\");","        return Json(null);","     * Generate a label for an input() call.","            .merge(\"id\", Json(null))","            .merge(\"input\", Json(null))","            .merge(\"nestedInput\", false)","            .merge(\"templateVars\", Json.emptyArray);","        STRINGAA labelAttributes = [\"templateVars\": options.get(\"templateVars\")];","                labelText = options.shift(\"text\").getString;","            labelAttributes = updateKey(labelAttributes, labelAttributes);","        labelAttributes.set(\"for\", options.get(\"id\"));","            labelAttributes.set(\"for\", false);","            labelAttributes.set(\"input\", options.get(\"input\"));","            labelAttributes.set(\"escape\", options.getBoolean(\"escape\"));","    string[] checkbox(string fieldName, Json[string] options = null) {","            .merge(\"hiddenField\", true)","            .merge(\"value\", 1);","        auto myvalue = options.shift(\"value\");","        options = _initInputField(fieldName, options);","        options.set(\"value\", myvalue);","            myhiddenOptions = createMap!(string, Json)","                .set(\"name\", options.getString)","                .set(\"value\", options.getString(\"hiddenField\") != \"_split\"","                        ? options.getString(\"hiddenField\") : \"0\")","                .set(\"form\", options.get(\"form\", null))","                .set(\"secure\", false);","                myhiddenOptions.set(\"disabled\", \"disabled\");","            outputText = hidden(fieldName, myhiddenOptions);","            options.removeKey(\"hiddenField\", \"type\");","            return [\"hidden\": outputText, \"input\": widget(\"checkbox\", options)];","        options.removeKeys(\"hiddenField\", \"type\");","        // return outputText ~ widget(\"checkbox\", options);","    string radio(string fieldName, Json[string] radioOptions = null, Json[string] attributes = null) {","        attributes.set(\"idPrefix\", _idPrefix);","            attributes.set(\"id\", true);","        attributes = _initInputField(fieldName, attributes);","        auto hiddenField = attributes.get(\"hiddenField\", true);","        attributes.removeKey(\"hiddenField\");","                    \"value\": hiddenField == true ? \"\": to!string(hiddenField),","                    \"form\": attributes[\"form\"].ifNull(null),","            removeKey(attributes[\"id\"]);","        string myradio = widget(\"radio\", attributes);","     * of various types. e.g. `this.Form.text();` will create `<input type=\"text\">` while","     * `this.Form.range();` will create `<input type=\"range\">`","     * this.Form.search(\"User.query\", [\"value\": \"test\"]);","    string __call(string methodName, Json[string] params) {","                \"Missing field name for `FormHelper.%s`.\".format(methodName));","        options.set(\"type\", options.get(\"type\", methodName));","        options = _initInputField(params[0], options);","    string textarea(string fieldName, Json[string] options = null) {","        options.removeKey(\"type\");","    string hidden(string fieldName, Json[string] htmlAttributes = null) {","            .merge(\"required\", false)","            .merge(\"secure\", true);","        auto mysecure = htmlAttributes.shift(\"secure\");","                options.get(\"name\"),","                options.hasKey(\"val\") ? \"0\" : options.getString(\"val\")","        options.set(\"type\", \"hidden\");","    string file(string fieldName, Json[string] options = null) {","        options.merge(\"secure\", true);","        options.removeKey(\"type\");","    string button(string title, Json[string] options = null) {","            .set(\"type\", \"submit\")","            .set(\"escapeTitle\", true)","            .set(\"escape\", true)","            .set(\"secure\", false)","            .set(\"confirm\", Json(null))","            .set(\"text\", title);","        options.removeKey(\"confirm\");","            myconfirm = _confirm(\"return true;\", \"return false;\");","            options.set(\"data-confirm-message\", confirmMessage);","            options.set(\"onclick\", this.templater().format(\"confirmJs\", [","                        \"confirmMessage\": htmlAttributeEscape(confirmMessage),","     * Instead use FormHelper.submit() or FormHelper.button() to create buttons inside opened forms.","     * HTTP/1.1 DELETE (or others) request. Defaults to \"post\".","     * - `form` - Array with any option that FormHelper.create() can take","    string postButton(string caption, string[] myurl, Json[string] options = null) {","            myformOptions.set(\"type\", options.shift(\"method\"));","            myformOptions = options.shift(\"form\") + myformOptions;","        result = create(null, myformOptions);","            foreach (aKey, myvalue; Hash.flatten(options.get(\"data\"))) {","                result ~= hidden(aKey, [\"value\": myvalue]);","            options.removeKey(\"data\");","        result ~= button(caption, options)","            ~ end();","     * (defaults to POST). Requires javascript to be enabled in browser.","     * `FormHelper.button()` or `FormHelper.submit()` instead.","     * - Other options are the same of HtmlHelper.link() method.","    string postLink(string title, string[] myurl = null, Json[string] options = null) {","        // options = options.addKeys([\"block\", \"confirm\"]);","            ? options.shift(\"method\").getString.upper","        auto confirmMessage = options.shift(\"confirm\");","        auto myformOptions = createMap!(string, Json)","            .set(\"name\", myformName)","            .set(\"style\", \"display:none;\")","            .set(\"method\", \"post\");","            myformOptions.set(\"target\", options.shift(\"target\"));","        lastAction(myurl);","            createMap!(string, Json)","                .set(\"action\", _url.build(myurl))","                .set(\"escape\", false));","        auto result = formatTemplate(\"formStart\", createMap!(string, Json)","                .set(\"attrs\", mytemplater.formatAttributes(myformOptions) ~ myaction));","        result ~= hidden(\"_method\", createMap!(string, Json)","                .set(\"value\", requestMethod)","                .set(\"secure\", SECURE_SKIP));","        auto myformTokenData = _view.getRequest().getAttribute(\"formTokenData\");","            _formProtector = this.createFormProtector(myformTokenData);","            options.removeKey(\"data\");","        result ~= this.secure(fieldNames);","        // result ~= formatTemplate(\"formEnd\", []);","                options.set(\"block\", __FUNCTION__);","            _view.append(options.get(\"block\"), result);","        options.removeKey(\"block\");","        string myonClick = \"document.\" ~ myformName ~ \".submit();\";","            myonClick = _confirm(myonClick, \"\");","            myonClick = this.templater().format(\"confirmJs\", [","                    \"confirmMessage\": htmlAttributeEscape(confirmMessage),","            options.set(\"data-confirm-message\", confirmMessage);","        options.set(\"onclick\", myonClick);","        result ~= _html.link(title, myurl, options);","    string submit(string caption = null, Json[string] options = null) {","            .merge(\"type\", \"submit\")","            .merge(\"secure\", false)","            _formProtector.addField(options.getString(options.get(\"secure\")));","        options.removeKey(\"secure\");","        bool isUrl = caption.contains(\": //\");","        bool isImage = false; // preg_match(\"/\\.(jpg|jpe|jpeg|gif|png|ico)my/\", caption);","        string mytype = options.shift(\"type\").getString;","                        options.getString(\"name\") ~ \"_x\",","                        options.getString(\"name\") ~ \"_y\",","            options.set(\"src\", caption);","                        \"App.imageBaseUrl\") ~ caption) : _url.webroot(trim(caption, \"/\"));","            myUrl = _url.assetTimestamp(myUrl);","            options.set(\"src\", myUrl);","            options.set(\"value\", caption);","                .set(\"type\", mytype)","                .set(\"attrs\", this.templater().formatAttributes(options))","                .set(\"templateVars\", options.get(\"templateVars\")));","        return _formatTemplate(\"submitContainer\", createMap!(string, Json)","                .set(\"content\", myinput)","     * this.Form.select(\"Model.field\", options));","     * this.Form.select(\"Model.field\", options);","    string select(string fieldName, Json[string] options = null, Json[string] attributes = null) {","            .merge(\"disabled\", Json(null))","            .merge(\"escape\", true)","            .merge(\"hiddenField\", true)","            .merge(\"multiple\", Json(null))","            .merge(\"secure\", true)","            .merge(\"empty\", Json(null));","            myrequired = _getContext().isRequired(fieldName);","            attributes.set(\"empty\", myrequired.isNull ? false : !myrequired);","            attributes.removeKey(\"multiple\", \"empty\");","            return _multiCheckbox(fieldName, options, attributes);","            attributes.hasKey(\"secure\") &&","            attributes.isAllEmpty(\"empty\", \"multiple\")","            attributes.set(\"secure\", false);","        attributes = _initInputField(fieldName, attributes);","        attributes.set(\"options\", options);","                .merge(\"name\", attributes.getString)","                .merge(\"value\", \"\")","                .merge(\"form\", attributes.get(\"form\"))","                .merge(\"secure\", false);","            myhidden = hidden(fieldName, myhiddenAttributes);","        attributes.removeKey(\"hiddenField\", \"type\");","    string multiCheckbox(string fieldName, Json[string] options, Json[string] htmlAttributes = null) {","            .merge(\"disabled\", Json(null))","            .merge(\"escape\", true)","            .merge(\"hiddenField\", true)","            .merge(\"secure\", true);","            htmlAttributes.set(\"id\", true);","        htmlAttributes = _initInputField(fieldName, htmlAttributes);","        htmlAttributes.set(\"options\", options);","                .merge(\"name\", htmlAttributes.getString(\"name\"))","                .merge(\"value\", \"\")","                .merge(\"secure\", false)","                .merge(\"disabled\", htmlAttributes.getString(\"disabled\") == \"disabled\")","                .merge(\"id\", htmlAttributes[\"id\"]);","            myhidden = hidden(fieldName, myhiddenAttributes);","        htmlAttributes.removeKey(\"hiddenField\");","            htmlAttributes.removeKey(\"id\");","    string year(string fieldName, Json[string] options = null) {","        options = _initInputField(fieldName, options);","        options.removeKey(\"type\");","    string month(string fieldName, Json[string] options = null) {","        options.merge(\"value\", Json(null));","        options.set(\"type\", \"month\");","    string dateTime(string fieldName, Json[string] options = null) {","        options.merge(\"value\", Json(null));","            .set(\"type\", \"datetime-local\")","            .set(\"fieldName\", fieldName);","    string time(string fieldName, Json[string] options = null) {","        options.merge([\"value\": Json(null)]);","        fieldOptions.set(\"type\", \"time\");","    string date(string fieldName, Json[string] options = null) {","        auto fieldOptions = _initInputField(fieldName, options);","        fieldOptions.set(\"type\", \"date\");","    protected Json[string] _initInputField(string fieldName, Json[string] options = null) {","        options.update(\"id\", _domId(fieldName));","                fieldName = subString(fieldName, 0, -2);","            string[] pathParts = fieldName.split(\".\");","            myfirst = pathParts.shift();","            options.set(\"name\", myfirst ~ (!pathParts.isEmpty ? \"[\" ~ pathParts.join(\".\") ~ \"]\" : \"\") ~ myendsWithBrackets);","            options.set(\"val\", options.shift(\"value\"));","            myvalOptions = createMap!(string, Json)","                .set(\"default\", options.get(\"default\"))","                .set(\"schemaDefault\", options.get(\"schemaDefault\", true));","            options.set(\"val\", getSourceValue(fieldName, myvalOptions));","        options.merge(\"val\", options.shift(\"default\"));","        options.removeKey(\"value\");","            options.set(\"val\", options.get(\"val\").value);","            options = addClass(options, configuration.get(\"errorClass\"));","        bool isDisabled = _isDisabled(options);","            options.set(\"secure\", SECURE_SKIP);","    protected bool _isDisabled(Json[string] options = null) {","            return options.getString(\"disabled\") == \"disabled\";","                \"options\", options.get(\"options\").keys[0]","                return options.get(\"options\").diff(options.get(\"disabled\")) == null;","                    options.get(\"options\"),","                    fn (index): isIn(index[\"value\"], options.get(\"disabled\"), true)","            // return count(mydisabled) > 0;","    IContext context(IContext formContext = null) {","        return _getContext();","    protected IContext _getContext(Json mydata = null) {","        // _locator.add([name: myspec]);","    string widget(string name, Json[string] options = null) {","            mysecure = options.shift(\"secure\");","        auto namedWidget = _locator.get(name);","        string result = namedWidget.render(options, context());","            options.hasKey(\"name\") &&","            namedWidget.secureFields(options)","    void resetTemplates() {","        // setTemplates(_defaultconfiguration.get(\"templates\"));","    override IEvent[] implementedEvents() {","    string[] getValueSources() {","    protected void validateValueSources(Json[string] sourceIds) {","                \"Invalid value source(s): %s. Valid values are: %s.\"","                    .format(mydiff.join(\", \"), _supportedValueSources.join(\", \"))","    // void setValueSources(string mysources) {","    void setValueSources(string[] mysources) {","    Json getSourceValue(string fieldName, Json[string] options = null) {","        auto myvalueMap = createMap!(string, Json)","            .set(\"data\", \"getData\")","            .set(\"query\", \"getQuery\");","        foreach (myvaluesSource; getValueSources()) {","                auto contextValue = _getContext().val(fieldName, options);","        return Json(null);","IForm getForm(string classname) {"]</td></tr><tr><td>implements</td><td>["DHelper"]</td></tr><tr><td>type</td><td>class</td></tr><tr><td>library</td><td>uim-views</td></tr></tbody></table>
        </div>
    </div><div class="card">
        <div class="table-responsive">
            <table class="table card-table"><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody><tr><td>    mixin(HelperThis!("Form"));</td></tr><tr><td>     * `data` - Corresponds to request data (POST/PUT).</td></tr><tr><td>    override bool initialize(Json[string] initData = null) {</td></tr><tr><td>            .set("string", "text")</td></tr><tr><td>            .set("text", "textarea")</td></tr><tr><td>            .set("uuid", "string")</td></tr><tr><td>            .set("datetime", "datetime")</td></tr><tr><td>            .set("datetimefractional", "datetime")</td></tr><tr><td>            .set("timestamp", "datetime")</td></tr><tr><td>            .set("timestampfractional", "datetime")</td></tr><tr><td>            .set("timestamptimezone", "datetime")</td></tr><tr><td>            .set("date", "date")</td></tr><tr><td>            .set("time", "time")</td></tr><tr><td>            .set("year", "year")</td></tr><tr><td>            .set("boolean", "checkbox")</td></tr><tr><td>            .set("float", "number")</td></tr><tr><td>            .set("integer", "number")</td></tr><tr><td>            .set("tinyinteger", "number")</td></tr><tr><td>            .set("smallinteger", "number")</td></tr><tr><td>            .set("decimal", "number")</td></tr><tr><td>            .set("binary", "file");</td></tr><tr><td>            .set("button", ["Button"])</td></tr><tr><td>            .set("checkbox", ["Checkbox"])</td></tr><tr><td>            .set("file", ["File"])</td></tr><tr><td>            .set("label", ["Label"])</td></tr><tr><td>            .set("nestingLabel", ["NestingLabel"])</td></tr><tr><td>            .set("multicheckbox", ["MultiCheckbox", "nestingLabel"])</td></tr><tr><td>            .set("radio", ["Radio", "nestingLabel"])</td></tr><tr><td>            .set("select", ["SelectBox"])</td></tr><tr><td>            .set("textarea", ["Textarea"])</td></tr><tr><td>            .set("datetime", ["DateTime", "select"])</td></tr><tr><td>            .set("year", ["Year", "select"])</td></tr><tr><td>            .set("_default", ["Basic"]);</td></tr><tr><td>            .setDefault("idPrefix", Json(null))</td></tr><tr><td>            .setDefault("errorClass", "form-error")</td></tr><tr><td>            // .setDefault("typeMap", typeMap)</td></tr><tr><td>            .setDefault("templates", createMap!(string, Json)) // set HTML5 validation message to custom required/empty messages</td></tr><tr><td>            .setDefault("autoSetCustomValidity", true);</td></tr><tr><td>            // mylocator = configuration.shift("locator");</td></tr><tr><td>                configuration.set("widgets", configuration.get("widgets").toArray);</td></tr><tr><td>            // mywidgets = configuration.shift("widgets").toArray ~ mywidgets;</td></tr><tr><td>            _groupedInputTypes = configuration.shift("groupedInputTypes").toStringArray;</td></tr><tr><td>    const string SECURE_SKIP = "skip"; // Defines the type of form being created. Set by FormHelper.create().</td></tr><tr><td>    setWidgetLocator(mylocator);</td></tr><tr><td>    _idPrefix = configuration.getString("idPrefix");</td></tr><tr><td>    DWidgetLocator getWidgetLocator() {</td></tr><tr><td>    void setWidgetLocator(DWidgetLocator myinstance) {</td></tr><tr><td>    DContextFactory contextFactory(DContextFactory factory = null, Json[string] contexts = null) {</td></tr><tr><td>            return _contextFactory ? _contextFactory : DContextFactory.createWithDefaults(contexts);</td></tr><tr><td>     * the form context"s isCreate() method returns false, a PUT request will be done.</td></tr><tr><td>     * - `encoding` Set the accept-charset encoding for the form. Defaults to `configuration.get("App.encoding")`</td></tr><tr><td>     * - `valueSources` The sources that values should be read from. See FormHelper.setValueSources()</td></tr><tr><td>    string create(Json formContext = null, Json[string] options = null) {</td></tr><tr><td>            context(formContext);</td></tr><tr><td>                options.set("context", Json(null));</td></tr><tr><td>            options.set("context.entity", formContext);</td></tr><tr><td>            formContext = _getContext(options.shift("context"));</td></tr><tr><td>        myisCreate = formContext.isCreate();</td></tr><tr><td>            .merge("type", myisCreate ? "post" : "put")</td></tr><tr><td>            .merge("url", Json(null))</td></tr><tr><td>            .merge("encoding", configuration.get("App.encoding").lower)</td></tr><tr><td>            .merge("templates", Json(null))</td></tr><tr><td>            .merge("idPrefix", Json(null))</td></tr><tr><td>            .merge("valueSources", Json(null));</td></tr><tr><td>            setValueSources(options.shift("valueSources"));</td></tr><tr><td>            _idPrefix = options.get("idPrefix");</td></tr><tr><td>        mytemplater = this.templater();</td></tr><tr><td>            mytemplater.push();</td></tr><tr><td>            methodName = isString(options.get("templates")) ? "load" : "add";</td></tr><tr><td>        options.removeKey("templates");</td></tr><tr><td>            myurl = _view.getRequest().getRequestTarget();</td></tr><tr><td>            myurl = _formUrl(formContext, options);</td></tr><tr><td>            myaction = _url.build(myurl);</td></tr><tr><td>        lastAction(myurl);</td></tr><tr><td>        options.removeKey("ur", "idPrefix");</td></tr><tr><td>        switch (options.get("type").lower) {</td></tr><tr><td>            myhtmlAttributes.get("method", "get");</td></tr><tr><td>            myhtmlAttributes.get("enctype", "multipart/form-data");</td></tr><tr><td>            options.set("type", myisCreate ? "post" : "put");</td></tr><tr><td>                    "value": options.getString("type").upper,</td></tr><tr><td>            myhtmlAttributes.get("method", "post");</td></tr><tr><td>            myhtmlAttributes.set("method", options.getString("method").lower);</td></tr><tr><td>            myhtmlAttributes.set("enctype", options.getString("enctype").lower);</td></tr><tr><td>        _requestType = options.getString("type").lower;</td></tr><tr><td>            myhtmlAttributes.set("accept-, set", options.get("encoding"));</td></tr><tr><td>        options.removeKey("type", "encoding");</td></tr><tr><td>            myformTokenData = _view.getRequest().getAttribute("formTokenData");</td></tr><tr><td>                _formProtector = this.createFormProtector(myformTokenData);</td></tr><tr><td>            myappend ~= _csrfField();</td></tr><tr><td>            myappend = mytemplater.format("hiddenBlock", ["content": myappend]);</td></tr><tr><td>        myactionAttr = mytemplater.formatAttributes(createMap!(string, Json)</td></tr><tr><td>                .set("action", myaction)</td></tr><tr><td>                .set("escape", false));</td></tr><tr><td>        return _formatTemplate("formStart", createMap!(string, Json)</td></tr><tr><td>                .set("attrs", mytemplater.formatAttributes(myhtmlAttributes) ~ myactionAttr)</td></tr><tr><td>                .set("templateVars", options.getArray("templateVars"))) ~ myappend;</td></tr><tr><td>    protected string[] _formUrl(IContext formContext, Json[string] options = null) {</td></tr><tr><td>            return request.getRequestTarget();</td></tr><tr><td>            options.isString("url") ||</td></tr><tr><td>            (options.isArray("url") && options.hasKey("url._name"))</td></tr><tr><td>            return options.get("url");</td></tr><tr><td>        return options.get("url")</td></tr><tr><td>            .merge("plugin", _view.pluginName)</td></tr><tr><td>            .merge("controller", request.getParam("controller"))</td></tr><tr><td>    protected void lastAction(string[] myurl = null) {</td></tr><tr><td>        auto myQuery = parse_url(myaction, D_URL_QUERY);</td></tr><tr><td>    protected string _csrfField() {</td></tr><tr><td>        auto csrfToken = request.getAttribute("csrfToken");</td></tr><tr><td>        return _hidden("_csrfToken", createMap!(string, Json)</td></tr><tr><td>                .set("value", csrfToken)</td></tr><tr><td>     * Closes an HTML form, cleans up values set by FormHelper.create(), and writes hidden</td></tr><tr><td>     * Resets some parts of the state, shared among multiple FormHelper.create() calls, to defaults.</td></tr><tr><td>    string end(Json[string] secureAttributes = null) {</td></tr><tr><td>            result ~= this.secure([], secureAttributes);</td></tr><tr><td>        result ~= formatTemplate("formEnd", []);</td></tr><tr><td>        templater().pop();</td></tr><tr><td>        _idPrefix = configurationData.hasKey("idPrefix");</td></tr><tr><td>    string secure(Json[string] fieldNames = null, Json[string] secureAttributes = null) {</td></tr><tr><td>            _formProtector.addField(fieldName, true, myvalue);</td></tr><tr><td>        auto mydebugSecurity = configuration.getBoolean("debug");</td></tr><tr><td>            secureAttributes.removeKey("debugSecurity");</td></tr><tr><td>           _getFormProtectorSessionId()</td></tr><tr><td>    protected string _getFormProtectorSessionId() {</td></tr><tr><td>        // return _view.getRequest().getSession().id();</td></tr><tr><td>    void unlockField(string fieldName) {</td></tr><tr><td>        getFormProtector().unlockField(fieldName);</td></tr><tr><td>    protected DFormProtector createFormProtector(Json[string] tokenData) {</td></tr><tr><td>        mysession.start();</td></tr><tr><td>    DFormProtector getFormProtector() {</td></tr><tr><td>                    " in your controller and called `FormHelper.create()` before calling `FormHelper.unlockField()`."</td></tr><tr><td>    bool isFieldError(string fieldName) {</td></tr><tr><td>        return _getContext().hasError(fieldName);</td></tr><tr><td>    string error(string fieldName, string[] text = null, Json[string] options = null) {</td></tr><tr><td>            fieldName = subString(fieldName, 0, -5);</td></tr><tr><td>        options.merge("escape", true);</td></tr><tr><td>        auto formContext = _getContext();</td></tr><tr><td>        auto myerror = formContext.error(fieldName);</td></tr><tr><td>            foreach (key, exception; myerror) {</td></tr><tr><td>            Json myerror = htmlAttributeEscape(myerror);</td></tr><tr><td>            options.removeKey("escape");</td></tr><tr><td>                foreach (error; myerror) {</td></tr><tr><td>                    myerrorText ~= formatTemplate("errorItem", ["text": error]);</td></tr><tr><td>                myerror = myerror.pop();</td></tr><tr><td>        return _formatTemplate("error", createMap!(string, Json)</td></tr><tr><td>                .set("content", myerror)</td></tr><tr><td>     * FormHelper._domId().</td></tr><tr><td>     * writeln(this.Form.label("published");</td></tr><tr><td>     * writeln(this.Form.label("published", "Publish");</td></tr><tr><td>     * "input": this.text("published"),</td></tr><tr><td>    string label(string fieldName, string text = null, Json[string] htmlAttributes = null) {</td></tr><tr><td>                text = subString(text, 0, -5);</td></tr><tr><td>                string[] fieldNameElements = text.split(".");</td></tr><tr><td>                text = fieldNameElements.pop();</td></tr><tr><td>                text = subString(text, 0, -3);</td></tr><tr><td>            text = __(text.underscore.humanize);</td></tr><tr><td>            htmlAttributes.removeKey("for");</td></tr><tr><td>            mylabelFor = _domId(fieldName);</td></tr><tr><td>            .set("for", mylabelFor)</td></tr><tr><td>            .set("text", text);</td></tr><tr><td>            return _widget("nestingLabel", attributes);</td></tr><tr><td>     * this.Form.allControls(["title": false]);</td></tr><tr><td>    string allControls(Json[string] fieldNames = null, Json[string] options = null) {</td></tr><tr><td>        auto mymodelFields = mycontext.fieldNames();</td></tr><tr><td>        auto fieldNames = array_merge(mymodelFields, fieldNames);</td></tr><tr><td>    string controls(Json[string] fieldNames, Json[string] options = null) {</td></tr><tr><td>        foreach (views, myopts; fieldNames) {</td></tr><tr><td>    string fieldset(string fieldNames = "", Json[string] options = null) {</td></tr><tr><td>        auto fieldNameset = options.getBoolean("fieldset", true);</td></tr><tr><td>        auto mycontext = _getContext();</td></tr><tr><td>            auto myisCreate = mycontext.isCreate();</td></tr><tr><td>            auto mymodelName = Inflector.singularize(_view.getRequest()</td></tr><tr><td>                    .getParam("controller")).humanize;</td></tr><tr><td>                result = formatTemplate("legend", ["text": isLegend]) ~ result;</td></tr><tr><td>                fieldNamesetParams["attrs"] = this.templater().formatAttributes(fieldNameset);</td></tr><tr><td>            result = formatTemplate("fieldset", fieldNamesetParams);</td></tr><tr><td>     * attributes or options for the different **type** methods can be included in `options` for control().</td></tr><tr><td>     * - `label` - Either a string label, or an array of options for the label. See FormHelper.label().</td></tr><tr><td>     * (field error and error messages).</td></tr><tr><td>    string control(string fieldName, Json[string] options = null) {</td></tr><tr><td>            .merge("type", Json(null))</td></tr><tr><td>            .merge("label", Json(null))</td></tr><tr><td>            .merge("error", Json(null))</td></tr><tr><td>            .merge("required", Json(null))</td></tr><tr><td>            .merge("options", Json(null))</td></tr><tr><td>            .merge("templates", Json.emptyArray)</td></tr><tr><td>            .merge("templateVars", Json.emptyArray)</td></tr><tr><td>            .merge("options", true);</td></tr><tr><td>        options = _parseOptions(fieldName, options);</td></tr><tr><td>        options.set("id", _domId(fieldName));</td></tr><tr><td>        auto mytemplater = this.templater();</td></tr><tr><td>        auto mynewTemplates = options.get("templates");</td></tr><tr><td>            mytemplater.push();</td></tr><tr><td>            mytemplateMethod = isString(options.getString("templates") ? "load" : "add");</td></tr><tr><td>        options.removeKey("templates");</td></tr><tr><td>            bool isFieldError = isFieldError(fieldName);</td></tr><tr><td>                .update("aria-required", options.getBoolean("required") ? "true" : null)</td></tr><tr><td>                .update("aria-invalid", isFieldError ? "true" : null);</td></tr><tr><td>                options.update("aria-label", options.get("placeholder"));</td></tr><tr><td>            myError = options.isArray("error")</td></tr><tr><td>                ? error(fieldName, options.get("error"), options.get("error")) : error(fieldName, options.get(</td></tr><tr><td>            options.removeKey("error");</td></tr><tr><td>        auto mylabel = options.shift("label");</td></tr><tr><td>        auto myoptions = options.shift("options");</td></tr><tr><td>        bool isNestedInput = options.getString("type") == "checkbox";</td></tr><tr><td>        isNestedInput = options.getBoolean("nestedInput", isNestedInput);</td></tr><tr><td>        options.removeKey("nestedInput");</td></tr><tr><td>            && options.getString("type") == "checkbox"</td></tr><tr><td>            && !hasKey("hiddenField", options)</td></tr><tr><td>            options.get("hiddenField", "_split");</td></tr><tr><td>        string myinput = _getInput(fieldName, options ~ ["options": myoptions]);</td></tr><tr><td>                mytemplater.pop();</td></tr><tr><td>        auto mylabel = _getLabel(fieldName, compact("input", "label", "error", "nestedInput").merge(</td></tr><tr><td>            ? _groupTemplate(compact("label", "error", "options")) : _groupTemplate(</td></tr><tr><td>                compact("input", "label", "error", "options"));</td></tr><tr><td>            mytemplater.pop();</td></tr><tr><td>    protected string _groupTemplate(Json[string] options = null) {</td></tr><tr><td>                "input": options.get("input"),</td></tr><tr><td>                "label": options.get("label"),</td></tr><tr><td>                "error": options.get("error"),</td></tr><tr><td>                "templateVars": options.get("options.templateVars"),</td></tr><tr><td>    protected string _inputContainerTemplate(Json[string] options = null) {</td></tr><tr><td>            "options.type") ~ "Container" ~ options.getString("errorSuffix");</td></tr><tr><td>            myinputContainerTemplate = "inputContainer" ~ options.getString("errorSuffix");</td></tr><tr><td>                "content": options.get("content"),</td></tr><tr><td>                "error": options.get("error"),</td></tr><tr><td>                "label": options.getString("label", ""),</td></tr><tr><td>                "required": options.get("options.required") ? " " ~ this.templater()</td></tr><tr><td>                .get("requiredClass"): "",</td></tr><tr><td>                "type": options.get("options.type"),</td></tr><tr><td>                "templateVars": options.get("options.templateVars", null),</td></tr><tr><td>    protected string[] _getInput(string fieldName, Json[string] options = null) {</td></tr><tr><td>        auto mylabel = options.shift("options");</td></tr><tr><td>        switch (options.getString("type").lower) {</td></tr><tr><td>            auto myopts = options.shift("options");</td></tr><tr><td>    protected Json[string] _parseOptions(string fieldName, Json[string] options = null) {</td></tr><tr><td>            options.set("type", _inputType(fieldName, options));</td></tr><tr><td>        return _magicOptions(fieldName, options, myneedsMagicType);</td></tr><tr><td>    protected string _inputType(string fieldName, Json[string] options = null) {</td></tr><tr><td>        auto mycontext = _getContext();</td></tr><tr><td>        auto internalType = mycontext.type(fieldName);</td></tr><tr><td>        auto mymap = configuration.get("typeMap");</td></tr><tr><td>        // auto fieldName = fieldName.split(".").slice(, -1)[0];</td></tr><tr><td>            options.hasKey("checked"): "checkbox",</td></tr><tr><td>            options.hasKey("options"): "select",</td></tr><tr><td>            isIn(fieldName, ["passwd", "password"], true): "password",</td></tr><tr><td>            isIn(fieldName, ["tel", "telephone", "phone"], true): "tel",</td></tr><tr><td>            options.hasKey("rows") || options.hasKey("cols") : "textarea",</td></tr><tr><td>    protected Json[string] _optionsOptions(string fieldName, Json[string] options = null) {</td></tr><tr><td>        auto internalType = _getContext().type(fieldName);</td></tr><tr><td>            mydbType = TypeFactory.build(internalType);</td></tr><tr><td>                    options.set("type", "select");</td></tr><tr><td>                options.set("options", this.enumOptions(mydbType.getEnumclassname()));</td></tr><tr><td>            fieldName = subString(fieldName, 0, -5);</td></tr><tr><td>            fieldName = subString(fieldName, 0, -3);</td></tr><tr><td>        fieldName = fieldName.split(".").slice(-1)[0];</td></tr><tr><td>            mypluralize ? Inflector.pluralize(fieldName) : fieldName</td></tr><tr><td>        myvarOptions = _view.get(myvarName);</td></tr><tr><td>            options.set("type", "select");</td></tr><tr><td>        options.set("options", myvarOptions);</td></tr><tr><td>    // TODO protected array<int|string, string> enumOptions(string enumclassname) {</td></tr><tr><td>        foreach (mycase; enumclassname.cases()) {</td></tr><tr><td>            myhasLabel = cast(IEnumLabel)mycase || hasMethod(mycase, "label");</td></tr><tr><td>            myvalues[mycase.value] = myhasLabel ? mycase.label(): mycase.name;</td></tr><tr><td>    protected Json[string] _magicOptions(string fieldName, Json[string] options, bool allowOverride) {</td></tr><tr><td>        options = setRequiredAndCustomValidity(fieldName, options);</td></tr><tr><td>        auto mymagicOptions = (isIn(options.get("type"), ["radio", "select"], true) || allowOverride);</td></tr><tr><td>            options = _optionsOptions(fieldName, options);</td></tr><tr><td>            options.set("type", "select");</td></tr><tr><td>                options.set("multiple", true);</td></tr><tr><td>    protected Json[string] setRequiredAndCustomValidity(string fieldName, Json[string] options = null) {</td></tr><tr><td>            options.set("required", mycontext.isRequired(fieldName));</td></tr><tr><td>        mymessage = mycontext.getRequiredMessage(fieldName);</td></tr><tr><td>        mymessage = htmlAttributeEscape(mymessage);</td></tr><tr><td>            options.set("templateVars.customValidityMessage", mymessage);</td></tr><tr><td>                options.set("data-validity-message", mymessage);</td></tr><tr><td>                    "setCustomValidity(\"\"); " ~</td></tr><tr><td>                options.set("oninput", "setCustomValidity(\"\")");</td></tr><tr><td>    protected string _getLabel(string fieldName, Json[string] options = null) {</td></tr><tr><td>        auto mylabel = options.get("label", null);</td></tr><tr><td>            return options.get("input");</td></tr><tr><td>        return Json(null);</td></tr><tr><td>     * Generate a label for an input() call.</td></tr><tr><td>            .merge("id", Json(null))</td></tr><tr><td>            .merge("input", Json(null))</td></tr><tr><td>            .merge("nestedInput", false)</td></tr><tr><td>            .merge("templateVars", Json.emptyArray);</td></tr><tr><td>        STRINGAA labelAttributes = ["templateVars": options.get("templateVars")];</td></tr><tr><td>                labelText = options.shift("text").getString;</td></tr><tr><td>            labelAttributes = updateKey(labelAttributes, labelAttributes);</td></tr><tr><td>        labelAttributes.set("for", options.get("id"));</td></tr><tr><td>            labelAttributes.set("for", false);</td></tr><tr><td>            labelAttributes.set("input", options.get("input"));</td></tr><tr><td>            labelAttributes.set("escape", options.getBoolean("escape"));</td></tr><tr><td>    string[] checkbox(string fieldName, Json[string] options = null) {</td></tr><tr><td>            .merge("hiddenField", true)</td></tr><tr><td>            .merge("value", 1);</td></tr><tr><td>        auto myvalue = options.shift("value");</td></tr><tr><td>        options = _initInputField(fieldName, options);</td></tr><tr><td>        options.set("value", myvalue);</td></tr><tr><td>            myhiddenOptions = createMap!(string, Json)</td></tr><tr><td>                .set("name", options.getString)</td></tr><tr><td>                .set("value", options.getString("hiddenField") != "_split"</td></tr><tr><td>                        ? options.getString("hiddenField") : "0")</td></tr><tr><td>                .set("form", options.get("form", null))</td></tr><tr><td>                .set("secure", false);</td></tr><tr><td>                myhiddenOptions.set("disabled", "disabled");</td></tr><tr><td>            outputText = hidden(fieldName, myhiddenOptions);</td></tr><tr><td>            options.removeKey("hiddenField", "type");</td></tr><tr><td>            return ["hidden": outputText, "input": widget("checkbox", options)];</td></tr><tr><td>        options.removeKeys("hiddenField", "type");</td></tr><tr><td>        // return outputText ~ widget("checkbox", options);</td></tr><tr><td>    string radio(string fieldName, Json[string] radioOptions = null, Json[string] attributes = null) {</td></tr><tr><td>        attributes.set("idPrefix", _idPrefix);</td></tr><tr><td>            attributes.set("id", true);</td></tr><tr><td>        attributes = _initInputField(fieldName, attributes);</td></tr><tr><td>        auto hiddenField = attributes.get("hiddenField", true);</td></tr><tr><td>        attributes.removeKey("hiddenField");</td></tr><tr><td>                    "value": hiddenField == true ? "": to!string(hiddenField),</td></tr><tr><td>                    "form": attributes["form"].ifNull(null),</td></tr><tr><td>            removeKey(attributes["id"]);</td></tr><tr><td>        string myradio = widget("radio", attributes);</td></tr><tr><td>     * of various types. e.g. `this.Form.text();` will create `<input type="text">` while</td></tr><tr><td>     * `this.Form.range();` will create `<input type="range">`</td></tr><tr><td>     * this.Form.search("User.query", ["value": "test"]);</td></tr><tr><td>    string __call(string methodName, Json[string] params) {</td></tr><tr><td>                "Missing field name for `FormHelper.%s`.".format(methodName));</td></tr><tr><td>        options.set("type", options.get("type", methodName));</td></tr><tr><td>        options = _initInputField(params[0], options);</td></tr><tr><td>    string textarea(string fieldName, Json[string] options = null) {</td></tr><tr><td>        options.removeKey("type");</td></tr><tr><td>    string hidden(string fieldName, Json[string] htmlAttributes = null) {</td></tr><tr><td>            .merge("required", false)</td></tr><tr><td>            .merge("secure", true);</td></tr><tr><td>        auto mysecure = htmlAttributes.shift("secure");</td></tr><tr><td>                options.get("name"),</td></tr><tr><td>                options.hasKey("val") ? "0" : options.getString("val")</td></tr><tr><td>        options.set("type", "hidden");</td></tr><tr><td>    string file(string fieldName, Json[string] options = null) {</td></tr><tr><td>        options.merge("secure", true);</td></tr><tr><td>        options.removeKey("type");</td></tr><tr><td>    string button(string title, Json[string] options = null) {</td></tr><tr><td>            .set("type", "submit")</td></tr><tr><td>            .set("escapeTitle", true)</td></tr><tr><td>            .set("escape", true)</td></tr><tr><td>            .set("secure", false)</td></tr><tr><td>            .set("confirm", Json(null))</td></tr><tr><td>            .set("text", title);</td></tr><tr><td>        options.removeKey("confirm");</td></tr><tr><td>            myconfirm = _confirm("return true;", "return false;");</td></tr><tr><td>            options.set("data-confirm-message", confirmMessage);</td></tr><tr><td>            options.set("onclick", this.templater().format("confirmJs", [</td></tr><tr><td>                        "confirmMessage": htmlAttributeEscape(confirmMessage),</td></tr><tr><td>     * Instead use FormHelper.submit() or FormHelper.button() to create buttons inside opened forms.</td></tr><tr><td>     * HTTP/1.1 DELETE (or others) request. Defaults to "post".</td></tr><tr><td>     * - `form` - Array with any option that FormHelper.create() can take</td></tr><tr><td>    string postButton(string caption, string[] myurl, Json[string] options = null) {</td></tr><tr><td>            myformOptions.set("type", options.shift("method"));</td></tr><tr><td>            myformOptions = options.shift("form") + myformOptions;</td></tr><tr><td>        result = create(null, myformOptions);</td></tr><tr><td>            foreach (aKey, myvalue; Hash.flatten(options.get("data"))) {</td></tr><tr><td>                result ~= hidden(aKey, ["value": myvalue]);</td></tr><tr><td>            options.removeKey("data");</td></tr><tr><td>        result ~= button(caption, options)</td></tr><tr><td>            ~ end();</td></tr><tr><td>     * (defaults to POST). Requires javascript to be enabled in browser.</td></tr><tr><td>     * `FormHelper.button()` or `FormHelper.submit()` instead.</td></tr><tr><td>     * - Other options are the same of HtmlHelper.link() method.</td></tr><tr><td>    string postLink(string title, string[] myurl = null, Json[string] options = null) {</td></tr><tr><td>        // options = options.addKeys(["block", "confirm"]);</td></tr><tr><td>            ? options.shift("method").getString.upper</td></tr><tr><td>        auto confirmMessage = options.shift("confirm");</td></tr><tr><td>        auto myformOptions = createMap!(string, Json)</td></tr><tr><td>            .set("name", myformName)</td></tr><tr><td>            .set("style", "display:none;")</td></tr><tr><td>            .set("method", "post");</td></tr><tr><td>            myformOptions.set("target", options.shift("target"));</td></tr><tr><td>        lastAction(myurl);</td></tr><tr><td>            createMap!(string, Json)</td></tr><tr><td>                .set("action", _url.build(myurl))</td></tr><tr><td>                .set("escape", false));</td></tr><tr><td>        auto result = formatTemplate("formStart", createMap!(string, Json)</td></tr><tr><td>                .set("attrs", mytemplater.formatAttributes(myformOptions) ~ myaction));</td></tr><tr><td>        result ~= hidden("_method", createMap!(string, Json)</td></tr><tr><td>                .set("value", requestMethod)</td></tr><tr><td>                .set("secure", SECURE_SKIP));</td></tr><tr><td>        auto myformTokenData = _view.getRequest().getAttribute("formTokenData");</td></tr><tr><td>            _formProtector = this.createFormProtector(myformTokenData);</td></tr><tr><td>            options.removeKey("data");</td></tr><tr><td>        result ~= this.secure(fieldNames);</td></tr><tr><td>        // result ~= formatTemplate("formEnd", []);</td></tr><tr><td>                options.set("block", __FUNCTION__);</td></tr><tr><td>            _view.append(options.get("block"), result);</td></tr><tr><td>        options.removeKey("block");</td></tr><tr><td>        string myonClick = "document." ~ myformName ~ ".submit();";</td></tr><tr><td>            myonClick = _confirm(myonClick, "");</td></tr><tr><td>            myonClick = this.templater().format("confirmJs", [</td></tr><tr><td>                    "confirmMessage": htmlAttributeEscape(confirmMessage),</td></tr><tr><td>            options.set("data-confirm-message", confirmMessage);</td></tr><tr><td>        options.set("onclick", myonClick);</td></tr><tr><td>        result ~= _html.link(title, myurl, options);</td></tr><tr><td>    string submit(string caption = null, Json[string] options = null) {</td></tr><tr><td>            .merge("type", "submit")</td></tr><tr><td>            .merge("secure", false)</td></tr><tr><td>            _formProtector.addField(options.getString(options.get("secure")));</td></tr><tr><td>        options.removeKey("secure");</td></tr><tr><td>        bool isUrl = caption.contains(": //");</td></tr><tr><td>        bool isImage = false; // preg_match("/\.(jpg|jpe|jpeg|gif|png|ico)my/", caption);</td></tr><tr><td>        string mytype = options.shift("type").getString;</td></tr><tr><td>                        options.getString("name") ~ "_x",</td></tr><tr><td>                        options.getString("name") ~ "_y",</td></tr><tr><td>            options.set("src", caption);</td></tr><tr><td>                        "App.imageBaseUrl") ~ caption) : _url.webroot(trim(caption, "/"));</td></tr><tr><td>            myUrl = _url.assetTimestamp(myUrl);</td></tr><tr><td>            options.set("src", myUrl);</td></tr><tr><td>            options.set("value", caption);</td></tr><tr><td>                .set("type", mytype)</td></tr><tr><td>                .set("attrs", this.templater().formatAttributes(options))</td></tr><tr><td>                .set("templateVars", options.get("templateVars")));</td></tr><tr><td>        return _formatTemplate("submitContainer", createMap!(string, Json)</td></tr><tr><td>                .set("content", myinput)</td></tr><tr><td>     * this.Form.select("Model.field", options));</td></tr><tr><td>     * this.Form.select("Model.field", options);</td></tr><tr><td>    string select(string fieldName, Json[string] options = null, Json[string] attributes = null) {</td></tr><tr><td>            .merge("disabled", Json(null))</td></tr><tr><td>            .merge("escape", true)</td></tr><tr><td>            .merge("hiddenField", true)</td></tr><tr><td>            .merge("multiple", Json(null))</td></tr><tr><td>            .merge("secure", true)</td></tr><tr><td>            .merge("empty", Json(null));</td></tr><tr><td>            myrequired = _getContext().isRequired(fieldName);</td></tr><tr><td>            attributes.set("empty", myrequired.isNull ? false : !myrequired);</td></tr><tr><td>            attributes.removeKey("multiple", "empty");</td></tr><tr><td>            return _multiCheckbox(fieldName, options, attributes);</td></tr><tr><td>            attributes.hasKey("secure") &&</td></tr><tr><td>            attributes.isAllEmpty("empty", "multiple")</td></tr><tr><td>            attributes.set("secure", false);</td></tr><tr><td>        attributes = _initInputField(fieldName, attributes);</td></tr><tr><td>        attributes.set("options", options);</td></tr><tr><td>                .merge("name", attributes.getString)</td></tr><tr><td>                .merge("value", "")</td></tr><tr><td>                .merge("form", attributes.get("form"))</td></tr><tr><td>                .merge("secure", false);</td></tr><tr><td>            myhidden = hidden(fieldName, myhiddenAttributes);</td></tr><tr><td>        attributes.removeKey("hiddenField", "type");</td></tr><tr><td>    string multiCheckbox(string fieldName, Json[string] options, Json[string] htmlAttributes = null) {</td></tr><tr><td>            .merge("disabled", Json(null))</td></tr><tr><td>            .merge("escape", true)</td></tr><tr><td>            .merge("hiddenField", true)</td></tr><tr><td>            .merge("secure", true);</td></tr><tr><td>            htmlAttributes.set("id", true);</td></tr><tr><td>        htmlAttributes = _initInputField(fieldName, htmlAttributes);</td></tr><tr><td>        htmlAttributes.set("options", options);</td></tr><tr><td>                .merge("name", htmlAttributes.getString("name"))</td></tr><tr><td>                .merge("value", "")</td></tr><tr><td>                .merge("secure", false)</td></tr><tr><td>                .merge("disabled", htmlAttributes.getString("disabled") == "disabled")</td></tr><tr><td>                .merge("id", htmlAttributes["id"]);</td></tr><tr><td>            myhidden = hidden(fieldName, myhiddenAttributes);</td></tr><tr><td>        htmlAttributes.removeKey("hiddenField");</td></tr><tr><td>            htmlAttributes.removeKey("id");</td></tr><tr><td>    string year(string fieldName, Json[string] options = null) {</td></tr><tr><td>        options = _initInputField(fieldName, options);</td></tr><tr><td>        options.removeKey("type");</td></tr><tr><td>    string month(string fieldName, Json[string] options = null) {</td></tr><tr><td>        options.merge("value", Json(null));</td></tr><tr><td>        options.set("type", "month");</td></tr><tr><td>    string dateTime(string fieldName, Json[string] options = null) {</td></tr><tr><td>        options.merge("value", Json(null));</td></tr><tr><td>            .set("type", "datetime-local")</td></tr><tr><td>            .set("fieldName", fieldName);</td></tr><tr><td>    string time(string fieldName, Json[string] options = null) {</td></tr><tr><td>        options.merge(["value": Json(null)]);</td></tr><tr><td>        fieldOptions.set("type", "time");</td></tr><tr><td>    string date(string fieldName, Json[string] options = null) {</td></tr><tr><td>        auto fieldOptions = _initInputField(fieldName, options);</td></tr><tr><td>        fieldOptions.set("type", "date");</td></tr><tr><td>    protected Json[string] _initInputField(string fieldName, Json[string] options = null) {</td></tr><tr><td>        options.update("id", _domId(fieldName));</td></tr><tr><td>                fieldName = subString(fieldName, 0, -2);</td></tr><tr><td>            string[] pathParts = fieldName.split(".");</td></tr><tr><td>            myfirst = pathParts.shift();</td></tr><tr><td>            options.set("name", myfirst ~ (!pathParts.isEmpty ? "[" ~ pathParts.join(".") ~ "]" : "") ~ myendsWithBrackets);</td></tr><tr><td>            options.set("val", options.shift("value"));</td></tr><tr><td>            myvalOptions = createMap!(string, Json)</td></tr><tr><td>                .set("default", options.get("default"))</td></tr><tr><td>                .set("schemaDefault", options.get("schemaDefault", true));</td></tr><tr><td>            options.set("val", getSourceValue(fieldName, myvalOptions));</td></tr><tr><td>        options.merge("val", options.shift("default"));</td></tr><tr><td>        options.removeKey("value");</td></tr><tr><td>            options.set("val", options.get("val").value);</td></tr><tr><td>            options = addClass(options, configuration.get("errorClass"));</td></tr><tr><td>        bool isDisabled = _isDisabled(options);</td></tr><tr><td>            options.set("secure", SECURE_SKIP);</td></tr><tr><td>    protected bool _isDisabled(Json[string] options = null) {</td></tr><tr><td>            return options.getString("disabled") == "disabled";</td></tr><tr><td>                "options", options.get("options").keys[0]</td></tr><tr><td>                return options.get("options").diff(options.get("disabled")) == null;</td></tr><tr><td>                    options.get("options"),</td></tr><tr><td>                    fn (index): isIn(index["value"], options.get("disabled"), true)</td></tr><tr><td>            // return count(mydisabled) > 0;</td></tr><tr><td>    IContext context(IContext formContext = null) {</td></tr><tr><td>        return _getContext();</td></tr><tr><td>    protected IContext _getContext(Json mydata = null) {</td></tr><tr><td>        // _locator.add([name: myspec]);</td></tr><tr><td>    string widget(string name, Json[string] options = null) {</td></tr><tr><td>            mysecure = options.shift("secure");</td></tr><tr><td>        auto namedWidget = _locator.get(name);</td></tr><tr><td>        string result = namedWidget.render(options, context());</td></tr><tr><td>            options.hasKey("name") &&</td></tr><tr><td>            namedWidget.secureFields(options)</td></tr><tr><td>    void resetTemplates() {</td></tr><tr><td>        // setTemplates(_defaultconfiguration.get("templates"));</td></tr><tr><td>    override IEvent[] implementedEvents() {</td></tr><tr><td>    string[] getValueSources() {</td></tr><tr><td>    protected void validateValueSources(Json[string] sourceIds) {</td></tr><tr><td>                "Invalid value source(s): %s. Valid values are: %s."</td></tr><tr><td>                    .format(mydiff.join(", "), _supportedValueSources.join(", "))</td></tr><tr><td>    // void setValueSources(string mysources) {</td></tr><tr><td>    void setValueSources(string[] mysources) {</td></tr><tr><td>    Json getSourceValue(string fieldName, Json[string] options = null) {</td></tr><tr><td>        auto myvalueMap = createMap!(string, Json)</td></tr><tr><td>            .set("data", "getData")</td></tr><tr><td>            .set("query", "getQuery");</td></tr><tr><td>        foreach (myvaluesSource; getValueSources()) {</td></tr><tr><td>                auto contextValue = _getContext().val(fieldName, options);</td></tr><tr><td>        return Json(null);</td></tr><tr><td>IForm getForm(string classname) {</td></tr></tbody></table>
        </div>
    </div>
                        </div>
                    </div>
                </div>
                <footer class="footer footer-transparent d-print-none">
    <div class="container-xl">
        <div
            class="row text-center align-items-center flex-row-reverse">
            <div class="col-lg-auto ms-lg-auto">
                <ul class="list-inline list-inline-dots mb-0">
                    <li class="list-inline-item"><a
                            href="https://tabler.io/docs"
                            target="_blank"
                            class="link-secondary"
                            rel="noopener">Documentation</a></li>
                    <li class="list-inline-item"><a
                            href="./license.html"
                            class="link-secondary">License</a></li>
                    <li class="list-inline-item"><a
                            href="https://github.com/tabler/tabler"
                            target="_blank"
                            class="link-secondary"
                            rel="noopener">Source code</a></li>
                    <li class="list-inline-item">
                        <a
                            href="https://github.com/sponsors/codecalm"
                            target="_blank"
                            class="link-secondary"
                            rel="noopener">
                            <!-- Download SVG icon from http://tabler-icons.io/i/heart -->
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24" height="24"
                                viewBox="0 0 24 24" fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                class="icon text-pink icon-filled icon-inline"><path
                                    stroke="none"
                                    d="M0 0h24v24H0z"
                                    fill="none"></path><path
                                    d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572"></path></svg>
                            Sponsor
                        </a>
                    </li>
                </ul>
            </div>
            <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                <ul class="list-inline list-inline-dots mb-0">
                    <li class="list-inline-item">
                        Copyright  2017 - 2024 <a href="." class="link-secondary">UIM framework</a>. All rights reserved.
                    </li>
                    <li class="list-inline-item">
                        <a href="./changelog.html" class="link-secondary" rel="noopener">v24.09.01</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

            </div>
        </div>
        <script src="https://uimsolutions.github.io/uim/js/tabler.min.js"></script>
    </body>
</html>
