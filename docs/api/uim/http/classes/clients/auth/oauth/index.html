<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Modern Business - uim Framework</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="https://uimsolutions.github.io/uim/assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="https://uimsolutions.github.io/uim/css/styles.css" rel="stylesheet" />
    </head>
    <body class="d-flex flex-column">
        <main class="flex-shrink-0">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
        <a class="navbar-brand" href="index.html">uim</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
                <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                <li class="nav-item"><a class="nav-link" href="faq.html">FAQ</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownBlog" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Packages</a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownBlog">
                        <li><a class="dropdown-item" href="blog-home.html">Blog Home</a></li>
                        <li><a class="dropdown-item" href="blog-post.html">Blog Post</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownBlog" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Blog</a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownBlog">
                        <li><a class="dropdown-item" href="blog-home.html">Blog Home</a></li>
                        <li><a class="dropdown-item" href="blog-post.html">Blog Post</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownPortfolio" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Portfolio</a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownPortfolio">
                        <li><a class="dropdown-item" href="portfolio-overview.html">Portfolio Overview</a></li>
                        <li><a class="dropdown-item" href="portfolio-item.html">Portfolio Item</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>	

            <!-- Header-->
            <header class="py-5">
                <div class="container px-5">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 col-xxl-6">
                            <div class="text-left my-5">
                                <nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/index.html">API</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/index.html">uim</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/http/index.html">http</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/http/classes/index.html">classes</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/http/classes/clients/index.html">clients</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/http/classes/clients/auth/index.html">auth</a></li><li class="breadcrumb-item active" aria-current="page">oauth</li></ol></nav>
                                <h1 class="fw-bolder mb-3">Class DOauth</h1>
                                <table><tr><td>filepath:C:\Users\ONS\PROJECTS2023\uim\http\uim\http\classes\clients\auth\oauth.d</td></tr><tr><td>parents:[]</td></tr><tr><td>namespace:uim.http.classes.clients.auth.oauth</td></tr><tr><td>name:DOauth</td></tr><tr><td>content:["    // Add headers for Oauth authorization.","    Request authentication(DRequest request, Json[string] authCredentials) {","        if (!authCredentials.hasKey(\"consumerKey\")) {","            return request;","        }","        authCredentials.set(\"method\", authCredentials.isEmpty(\"method\")","            ? \"hmac-sha1\"","            : authCredentials.getString(\"method\").upper);","        switch (authCredentials.getString(\"method\")) {","        case \"HMAC-SHA1\":","            bool hasKeys = authCredentials.hasKeys([","                \"consumerSecret\", \"token\", \"tokenSecret\"","            ]);","            if (!hasKeys) {","                return request;","            }","            aValue = _hmacSha1(request, authCredentials);","            break;","        case \"RSA-SHA1\":","            if (!authCredentials.hasKey(\"privateKey\")) {","                return request;","            }","            aValue = _rsaSha1(request, authCredentials);","            break;","        case \"PLAINTEXT\":","            hasKeys = isSet(","                authCredentials[\"consumerSecret\"],","                authCredentials[\"token\"],","                authCredentials[\"tokenSecret\"]","           );","            if (!hasKeys) {","                return request;","            }","            aValue = _plaintext(request, authCredentials);","            break;","        default:","            throw new DException(","                \"Unknown Oauth signature method `%s`.\".format(authCredentials[\"method\"]));","        }","        return request.withHeader(\"Authorization\", aValue);","    }","    /**","     * Plaintext signing","     *","     * This method is **not** suitable for plain HTTP.","     * You should only ever use PLAINTEXT when dealing with SSL","     * services.","     * Params:","     * \\UIM\\Http\\Client\\Request request The request object.","     */","    protected string _plaintext(Request request, Json[string] authCredentials) {","        auto someValues = [","            \"oauth_version\": \"1.0\",","            \"oauth_nonce\": uniqid(),","            \"oauth_timestamp\": time(),","            \"oauth_signature_method\": \"PLAINTEXT\",","            \"oauth_token\": authCredentials.get(\"token\"),","            \"oauth_consumer_key\": authCredentials.get(\"consumerKey\"),","        ];","        if (authCredentials.hasKey(\"realm\")) {","            someValues.set(\"oauth_realm\", authCredentials.get(\"realm\"));","        }","        string[] keys = [","            authCredentials[\"consumerSecret\"], authCredentials.get(\"tokenSecret\")","        ];","        string key = keys.join(\"&\");","        someValues.set(\"oauth_signature\", key);","        return _buildAuth(someValues);","    }","    /**","     * Use HMAC-SHA1 signing.","     * This method is suitable for plain HTTP or HTTPS.","     */","    protected string _hmacSha1(Request request, Json[string] authCredentials) {","        auto nonce = authCredentials.get(\"nonce\", uniqid());","        auto timestamp = authCredentials.get(\"timestamp\", time());","        someValues = [","            \"oauth_version\": \"1.0\",","            \"oauth_nonce\": nonce,","            \"oauth_timestamp\": timestamp,","            \"oauth_signature_method\": \"HMAC-SHA1\",","            \"oauth_token\": authCredentials[\"token\"],","            \"oauth_consumer_key\": _encode(authCredentials[\"consumerKey\"]),","        ];","        baseString = this.baseString(request, someValues);","        // Consumer key should only be encoded for base string calculation as","        // auth header generation already encodes independently","        someValues.set(\"oauth_consumer_key\", authCredentials[\"consumerKey\"]);","        if (authCredentials.hasKey(\"realm\")) {","            someValues.set(\"oauth_realm\", authCredentials[\"realm\"]);","        }","        string[] key = [","            authCredentials.getString(\"consumerSecret\"), authCredentials.getString(\"tokenSecret\")","        ];","        // key = array_map(_encode(...), key);","        key = key.join(\"&\");","        someValues.set(\"oauth_signature\", base64_encode(","            hash_hmac(\"sha1\", baseString, key, true)","       ));","        return _buildAuth(someValues);","    }","    /**","     * Use RSA-SHA1 signing.","     * This method is suitable for plain HTTP or HTTPS. */","    protected string _rsaSha1(Request request, Json[string] authCredentials) {","        if (!function_hasKey(\"openssl_pkey_get_private\")) {","            throw new DException(\"RSA-SHA1 signature method requires the OpenSSL extension.\");","        }","        auto nonce = authCredentials.get(\"nonce\", bin2hex(Security.randomBytes(16)));","        auto timestamp = authCredentials.get(\"timestamp\", time());","        auto someValues = [","            \"oauth_version\": \"1.0\",","            \"oauth_nonce\": nonce,","            \"oauth_timestamp\": timestamp,","            \"oauth_signature_method\": \"RSA-SHA1\",","            \"oauth_consumer_key\": authCredentials[\"consumerKey\"],","        ];","        if (authCredentials.hasKey(\"consumerSecret\")) {","            someValues.set(\"oauth_consumer_secret\", authCredentials[\"consumerSecret\"]);","        }","        if (authCredentials.hasKey(\"token\")) {","            someValues.set(\"oauth_token\", authCredentials[\"token\"]);","        }","        if (authCredentials.hasKey(\"tokenSecret\")) {","            someValues.set(\"oauth_token_secret\", authCredentials[\"tokenSecret\"]);","        }","        auto baseString = this.baseString(request, someValues);","        if (authCredentials.hasKey(\"realm\")) {","            someValues.set(\"oauth_realm\", authCredentials[\"realm\"]);","        }","        if (isResource(authCredentials.get(\"privateKey\"))) {","            auto resource = authCredentials.get(\"privateKey\");","            auto privateKey = stream_get_contents(resource);","            rewind(resource);","            authCredentials.set(\"privateKey\", privateKey);","        }","        authCredentials.merge(\"privateKeyPassphrase\", \"\");","        if (isResource(authCredentials[\"privateKeyPassphrase\"])) {","            auto resource = authCredentials[\"privateKeyPassphrase\"];","            auto passphrase = stream_get_line(resource, 0, D_EOL);","            rewind(resource);","            authCredentials.set(\"privateKeyPassphrase\", passphrase);","        }","        /** @var \\OpenSSLAsymmetricKey|\\OpenSSLCertificate|string[] aprivateKey */","        auto privateKey = openssl_pkey_get_private(authCredentials[\"privateKey\"], authCredentials[\"privateKeyPassphrase\"]);","        this.checkSslError();","        auto signature = \"\";","        openssl_sign(baseString, signature, privateKey);","        this.checkSslError();","        someValues[\"oauth_signature\"] = base64_encode(signature);","        return _buildAuth(someValues);","    }","    /**","     * Generate the Oauth basestring","     *","     * - Querystring, request data and oauth_* parameters are combined.","     * - Values are sorted by name and then value.","     * - Request values are concatenated and urlencoded.","     * - The request URL (without querystring) is normalized.","     * - The HTTP method, URL and request parameters are concatenated and returned.","     */","    string baseString(Request request, Json[string] oauthData) {","        auto someParts = [","            request.getMethod(),","            _normalizedUrl(request.getUri()),","            _normalizedParams(request, oauthData),","        ];","        // someParts = array_map(_encode(...), someParts);","        return join(\"&\", someParts);","    }","    // Builds a normalized URL","    protected string _normalizedUrl(IUri anUri) {","        return anUri.getScheme() ~ \": //\" ~ anUri.getHost().lower ~ anUri.getPath();","    }","    /**","     * Sorts and normalizes request data and oauthData","     *","     * Section 9.1.1 of Oauth spec.","     *","     * - URL encode keys + values.","     * - Sort keys & values by byte value.","     */","    protected string _normalizedParams(Request request, Json[string] oauthData) {","        auto aQuery = parse_url(/* (string)  */request.getUri(), UIM_URL_QUERY);","        // parse_str((string) aQuery, aQueryArgs);","        auto post = null;","        string contentType = request.getHeaderLine(\"Content-Type\");","        if (contentType.isEmpty || contentType == \"application/x-www-form-urlencoded\") {","            // parse_str(to!string(request.getBody()), post);","        }","        auto arguments = chain(aQueryArgs, oauthData, post);","        auto pairs = _normalizeData(arguments);","        auto someData = null;","        foreach (pair; pairs) {","            someData ~= pair.join(\"=\");","        }","        sort(someData, SORT_STRING);","        return join(\"&\", someData);","    }","    // Recursively convert request data into the normalized form.","    protected Json[string] _normalizeData(Json[string] arguments, string convertedPath = null) {","        auto someData = null;","        arguments.byKeyValue((kv) {","            if (convertedPath) {","                // Fold string keys with [].","                // Numeric keys result in a=b&a=c. While this isn`t","                // standard behavior in D, it is common in other platforms.","                kv.key = !isNumeric(kv.key)","                    ? \"{convertedPath}[{kv.key}]\"","                    : convertedPath;","            }","            if (isArray(kv.value)) {","                uksort(kv.value, \"strcmp\");","                someData = array_merge(someData, _normalizeData(kv.value, kv.key));","            } else {","                someData ~= [kv.key, kv.value];","            }","        });","        return someData;","    }","    // Builds the Oauth Authorization header value.","    protected string _buildAuth(Json[string] oauthData) {","        string result = \"OAuth \";","        string[] params = someData.byKeyValue","            .map!(kv => kv.key ~ \"=\\\"\" ~ _encode(/* (string)  */kv.value) ~ \"\\\"\").array;","        result ~= params.join(\",\");","        return result;","    }","    // URL Encodes a value based on rules of rfc3986","    protected string _encode(string valueToEncode) {","        return rawUrlEncode(valueToEncode).replace([\"%7E\", \"+\"], [\"~\", \" \"]);","    }","    // Check for SSL errors and throw an exception if found.","    protected void checkSslError() {","        string error = \"\";","        while (text = openssl_error_string()) {","            error ~= text;","        }","        if (error.length > 0) {","            throw new DException(\"openssl error: \" ~ error);","        }","    }"]</td></tr><tr><td>methods:[{"isProperty":false,"parameters":["DRequest request","Json[string] authCredentials"],"datatype":"Request","name":"authentication","isAbstract":false,"isInherited":false,"header":"Request authentication(DRequest request, Json[string] authCredentials)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!authCredentials.hasKey(\"consumerKey\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"switch","name":"","isAbstract":false,"isInherited":false,"header":"switch (authCredentials.getString(\"method\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!hasKeys)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!authCredentials.hasKey(\"privateKey\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!hasKeys)","isStatic":false},{"isProperty":false,"parameters":["Request request","Json[string] authCredentials"],"datatype":"protected","name":"string _plaintext","isAbstract":false,"isInherited":false,"header":"protected string _plaintext(Request request, Json[string] authCredentials)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (authCredentials.hasKey(\"realm\"))","isStatic":false},{"isProperty":false,"parameters":["Request request","Json[string] authCredentials"],"datatype":"protected","name":"string _hmacSha1","isAbstract":false,"isInherited":false,"header":"protected string _hmacSha1(Request request, Json[string] authCredentials)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (authCredentials.hasKey(\"realm\"))","isStatic":false},{"isProperty":false,"parameters":["Request request","Json[string] authCredentials"],"datatype":"protected","name":"string _rsaSha1","isAbstract":false,"isInherited":false,"header":"protected string _rsaSha1(Request request, Json[string] authCredentials)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!function_hasKey(\"openssl_pkey_get_private\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (authCredentials.hasKey(\"consumerSecret\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (authCredentials.hasKey(\"token\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (authCredentials.hasKey(\"tokenSecret\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (authCredentials.hasKey(\"realm\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (isResource(authCredentials.get(\"privateKey\")))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (isResource(authCredentials[\"privateKeyPassphrase\"]))","isStatic":false},{"isProperty":false,"parameters":["Request request","Json[string] oauthData"],"datatype":"string","name":"baseString","isAbstract":false,"isInherited":false,"header":"string baseString(Request request, Json[string] oauthData)","isStatic":false},{"isProperty":false,"parameters":["IUri anUri"],"datatype":"protected","name":"string _normalizedUrl","isAbstract":false,"isInherited":false,"header":"protected string _normalizedUrl(IUri anUri)","isStatic":false},{"isProperty":false,"parameters":["Request request","Json[string] oauthData"],"datatype":"protected","name":"string _normalizedParams","isAbstract":false,"isInherited":false,"header":"protected string _normalizedParams(Request request, Json[string] oauthData)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (contentType.isEmpty || contentType == \"application/x-www-form-urlencoded\")","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"foreach","name":"","isAbstract":false,"isInherited":false,"header":"foreach (pair; pairs)","isStatic":false},{"isProperty":false,"parameters":["Json[string] arguments","string convertedPath = null"],"datatype":"protected","name":"Json[string] _normalizeData","isAbstract":false,"isInherited":false,"header":"protected Json[string] _normalizeData(Json[string] arguments, string convertedPath = null)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"arguments.byKeyValue((kv)","name":"","isAbstract":false,"isInherited":false,"header":"arguments.byKeyValue((kv)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (convertedPath)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (isArray(kv.value))","isStatic":false},{"isProperty":false,"parameters":["Json[string] oauthData"],"datatype":"protected","name":"string _buildAuth","isAbstract":false,"isInherited":false,"header":"protected string _buildAuth(Json[string] oauthData)","isStatic":false},{"isProperty":false,"parameters":["string valueToEncode"],"datatype":"protected","name":"string _encode","isAbstract":false,"isInherited":false,"header":"protected string _encode(string valueToEncode)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"protected","name":"void checkSslError","isAbstract":false,"isInherited":false,"header":"protected void checkSslError()","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"while","name":"","isAbstract":false,"isInherited":false,"header":"while (text = openssl_error_string())","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (error.length > 0)","isStatic":false}]</td></tr><tr><td>type:class</td></tr></table>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- About section one-->
            <section class="py-5 bg-light" id="scroll-target">
                <div class="container px-5 my-5">
                </div>
            </section>
        </main>
        <!-- Footer-->
        <footer class="bg-dark py-4 mt-auto">
    <div class="container px-5">
        <div class="row align-items-center justify-content-between flex-column flex-sm-row">
            <div class="col-auto"><div class="small m-0 text-white">Copyright &copy; 2015 - 2024 Ozan Nurettin Süel</div></div>
            <div class="col-auto">
                <a class="link-light small" href="#!">Privacy</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="#!">Terms</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="#!">Contact</a>
            </div>
        </div>
    </div>
</footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
