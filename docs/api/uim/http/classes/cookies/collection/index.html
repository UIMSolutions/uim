<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Modern Business - uim Framework</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="https://uimsolutions.github.io/uim/assets/favicon.ico" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="https://uimsolutions.github.io/uim/css/styles.css" rel="stylesheet" />
    </head>
    <body class="d-flex flex-column">
        <main class="flex-shrink-0">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
        <a class="navbar-brand" href="index.html">uim</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
                <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                <li class="nav-item"><a class="nav-link" href="faq.html">FAQ</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownBlog" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Packages</a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownBlog">
                        <li><a class="dropdown-item" href="blog-home.html">Blog Home</a></li>
                        <li><a class="dropdown-item" href="blog-post.html">Blog Post</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownBlog" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Blog</a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownBlog">
                        <li><a class="dropdown-item" href="blog-home.html">Blog Home</a></li>
                        <li><a class="dropdown-item" href="blog-post.html">Blog Post</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownPortfolio" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Portfolio</a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownPortfolio">
                        <li><a class="dropdown-item" href="portfolio-overview.html">Portfolio Overview</a></li>
                        <li><a class="dropdown-item" href="portfolio-item.html">Portfolio Item</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>	

            <!-- Header-->
            <header class="py-5">
                <div class="container px-5">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 col-xxl-6">
                            <div class="text-left my-5">
                                <nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/index.html">API</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/index.html">uim</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/http/index.html">http</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/http/classes/index.html">classes</a></li><li class="breadcrumb-item"><a href="https://uimsolutions.github.io/uim/api/uim/http/classes/cookies/index.html">cookies</a></li><li class="breadcrumb-item active" aria-current="page">collection</li></ol></nav>
                                <h1 class="fw-bolder mb-3">Class DCookieCollection</h1>
                                <table><tr><td>filepath:C:\Users\ONS\PROJECTS2023\uim\http\uim\http\classes\cookies\collection.d</td></tr><tr><td>parents:[]</td></tr><tr><td>namespace:uim.http.classes.cookies.collection</td></tr><tr><td>name:DCookieCollection</td></tr><tr><td>content:["    // Cookie objects","    protected Json[string] cookies;","    /**","     * Params:","     * array<\\UIM\\Http\\Cookie\\ICookie> cookies Array of cookie objects","     */","    this(Json[string] cookies = null) {","        this.checkCookies(cookies);","        cookies.each!(cookie => _cookies[cookie.id] = cookie);","    }","    // Create a Cookie Collection from an array of Set-Cookie Headers","    static auto createFromHeader(string[] headerValues, Json[string] defaultAttributes = null) {","        cookies = null;","        headerValues.each!((value) {","            try {","                cookies ~= Cookie.createFromHeaderString(value, defaultAttributes);","            } catch (Exception | TypeError  anException) {","                // Don`t blow up on invalid cookies","            }","        });","        return new static(cookies);","    }","    // Create a new DCollection from the cookies in a ServerRequest","    static DCookieCollection createFromServerRequest(IServerRequest request) {","        auto items = request.getCookieParams();","        auto cookies = items.byKeyValue.each!(item => new DCookie(item.key, item.value)).array;","        return new DCookieCollection(cookies);","    }","    // Get the number of cookies in the collection.","    size_t count() {","        return _cookies.length;","    }","    /**","     * Add a cookie and get an updated collection.","     *","     * Cookies are stored by id. This means that there can be duplicate","     * cookies if a cookie collection is used for cookies across multiple","     * domains. This can impact how get(), has() and removeKey() behave.","     */","    static DCookieCollection add(ICookie cookie) {","        DCookieCollection cookieCollection = this.clone;","        cookieCollection.cookies[cookie.id()] = cookie;","        return cookieCollection;","    }","    /**","     * Get the first cookie by name.","     */","    ICookie get(string cookieName) {","        auto cookie = __get(cookieName);","        if (cookie.isNull) {","            throw new DInvalidArgumentException(","                \"Cookie `%s` not found. Use `has()` to check first for existence.\"","                .format(cookieName)","           );","        }","        return cookie;","    }","    // Check if a cookie with the given name exists","    auto has(string cookieName) {","        return !__get(cookieName).isNull;","    }","    /**","     * Get the first cookie by name if cookie with provided name exists","     * Params:","     * string aName The name of the cookie.","     */","    ICookie __get(string cookieName) {","        aKey = mb_strtolower(cookieName);","        foreach (cookie; _cookies) {","            if (mb_strtolower(cookie.name) == aKey) {","                return cookie;","            }","        }","        return null;","    }","    // Check if a cookie with the given name exists","    bool __isSet(string cookieName) {","        return !__get(cookieName)isNull;","    }","    /**","     * Create a new DCollection with all cookies matching name removed.","     *","     * If the cookie is not in the collection, this method will do nothing.","     */","    static removeKey(string cookieName) {","        auto result = this.clone;","        aKey = mb_strtolower(cookieName);","        foreach (result.cookies as  index: cookie) {","            if (mb_strtolower(cookie.cookieName) == aKey) {","                removeKey(result.cookies[index]);","            }","        }","        return result;","    }","    // Checks if only valid cookie objects are in the array","    protected void checkCookies(ICookie[] cookies) {","        foreach (anIndex: cookie; cookies) {","            if (!cast(ICookie)!cookie) {","                throw new DInvalidArgumentException(","                    \"Expected `%s[]` as cookies but instead got `%s` at index %d\"","                    .format(","                        class,","                        get_debug_type(cookie),","                        anIndex","                   )","               );","            }","        }","    }","    // Gets the iterator","    DTraversable getIterator() {","        return new DArrayIterator(_cookies);","    }","    /**","     * Add cookies that match the path/domain/expiration to the request.","     *","     * This allows CookieCollections to be used as a 'cookie jar' in an HTTP client","     * situation. Cookies that match the request`s domain + path that are not expired","     * when this method is called will be applied to the request.","     */","    IRequest addToRequest(IRequest request, Json[string] extraCookies = null) {","        auto anUri = request.getUri();","        cookies = this.findMatchingCookies(","            anUri.getScheme(),","            anUri.getHost(),","            anUri.getPath() ?: '/'","       );","        cookies = extraCookies + cookies;","        string[] cookiePairs;","        cookies.byKeyValue.each!((kv) {","            auto cookie = \"%s=%s\".format(rawUrlEncode((string)kv.key), rawUrlEncode(kv.value));","            auto size = cookie.length;","            if (size > 4096) {","                triggerWarning(","                    \"The cookie `%s` exceeds the recommended maximum cookie length of 4096 bytes.\"","                    .format(kv.key)","               );","            }","            cookiePairs ~= cookie;","        });","        if (cookiePairs.isEmpty() {","            return request;","        }","        return request.withHeader(\"Cookie\", cookiePairs.join(\"; \"));","    }","    // Find cookies matching the scheme, host, and path","    protected Json[string] findMatchingCookies(string hhtpScheme, string hostToMatch, string pathToMatch) {","        Json[string] result;","        auto now = new DateTimeImmutable(\"now\", new DateTimeZone(\"UTC\"));","        foreach (cookie; _cookies) {","            if (hhtpScheme == \"http\" && cookie.isSecure()) {","                continue;","            }","            if (!pathToMatch.startWith(cookie.getPath())) {","                continue;","            }","            auto domain = cookie.domain();","            if (domain.startWith(\".\")) {","                domain = stripLeft(domain, \".\");","            }","            if (cookie.isExpired(now)) {","                continue;","            }","            string pattern = \"/\" ~ preg_quote(domain, \"/\") ~ \"/\";","            if (!preg_match(pattern, hostToMatch)) {","                continue;","            }","             result[cookie.name] = cookie.getValue();","        }","        return result;","    }","    // Create a new DCollection that includes cookies from the response.","    static addFromResponse(IResponse response, IRequest request) {","        anUri = request.getUri();","        host = anUri.getHost();","        somePath = anUri.getPath() ?: \"/\";","        cookies = createFromHeader(","            response.getHeader(\"Set-Cookie\"),","            [\"domain\": host, \"path\": somePath]","       );","        new = this.clone;","        foreach (cookie; cookies) {","            new.cookies[cookie.id()] = cookie;","        }","        new.removeExpiredCookies(host, somePath);","        return new;","    }","    /**","     * Remove expired cookies from the collection.","     * Params:","     * string ahost The host to check for expired cookies on.","     */","    protected void removeExpiredCookies(string hostToCheck, string pathToCheck) {","        auto time = new DateTimeImmutable(\"now\", new DateTimeZone(\"UTC\"));","        string hostPattern = \"/\" ~ preg_quote(hostToCheck, \"/\") ~ \"/\";","        foreach (index: cookie; _cookies) {","            if (!cookie.isExpired(time)) {","                continue;","            }","            auto somePathMatches = somePath.startWith(cookie.getPath());","            auto hostMatches = preg_match(hostPattern, cookie.domain());","            if (somePathMatches && hostMatches) {","                removeKey(_cookies[index]);","            }","        }","    }"]</td></tr><tr><td>methods:[{"isProperty":false,"datatype":null,"name":"this","isAbstract":false,"isInherited":false,"header":"this(Json[string] cookies = null)","isStatic":false},{"isProperty":false,"parameters":["string[] headerValues","Json[string] defaultAttributes = null"],"datatype":"auto","name":"createFromHeader","isAbstract":false,"isInherited":false,"header":"auto createFromHeader(string[] headerValues, Json[string] defaultAttributes = null)","isStatic":true},{"isProperty":false,"parameters":[],"datatype":"headerValues.each!((value)","name":"","isAbstract":false,"isInherited":false,"header":"headerValues.each!((value)","isStatic":false},{"isProperty":false,"parameters":["IServerRequest request"],"datatype":"DCookieCollection","name":"createFromServerRequest","isAbstract":false,"isInherited":false,"header":"DCookieCollection createFromServerRequest(IServerRequest request)","isStatic":true},{"isProperty":false,"parameters":[],"datatype":"size_t","name":"count","isAbstract":false,"isInherited":false,"header":"size_t count()","isStatic":false},{"isProperty":false,"parameters":["ICookie cookie"],"datatype":"DCookieCollection","name":"add","isAbstract":false,"isInherited":false,"header":"DCookieCollection add(ICookie cookie)","isStatic":true},{"isProperty":false,"parameters":["string cookieName"],"datatype":"ICookie","name":"get","isAbstract":false,"isInherited":false,"header":"ICookie get(string cookieName)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (cookie.isNull)","isStatic":false},{"isProperty":false,"parameters":["string cookieName"],"datatype":"auto","name":"has","isAbstract":false,"isInherited":false,"header":"auto has(string cookieName)","isStatic":false},{"isProperty":false,"parameters":["string cookieName"],"datatype":"ICookie","name":"__get","isAbstract":false,"isInherited":false,"header":"ICookie __get(string cookieName)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"foreach","name":"","isAbstract":false,"isInherited":false,"header":"foreach (cookie; _cookies)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (mb_strtolower(cookie.name) == aKey)","isStatic":false},{"isProperty":false,"parameters":["string cookieName"],"datatype":"bool","name":"__isSet","isAbstract":false,"isInherited":false,"header":"bool __isSet(string cookieName)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"removeKey(string","name":"","isAbstract":false,"isInherited":false,"header":"removeKey(string cookieName)","isStatic":true},{"isProperty":false,"parameters":[],"datatype":"foreach","name":"","isAbstract":false,"isInherited":false,"header":"foreach (result.cookies as  index: cookie)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (mb_strtolower(cookie.cookieName) == aKey)","isStatic":false},{"isProperty":false,"parameters":["ICookie[] cookies"],"datatype":"protected","name":"void checkCookies","isAbstract":false,"isInherited":false,"header":"protected void checkCookies(ICookie[] cookies)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"foreach","name":"","isAbstract":false,"isInherited":false,"header":"foreach (anIndex: cookie; cookies)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!cast(ICookie)!cookie)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"DTraversable","name":"getIterator","isAbstract":false,"isInherited":false,"header":"DTraversable getIterator()","isStatic":false},{"isProperty":false,"parameters":["IRequest request","Json[string] extraCookies = null"],"datatype":"IRequest","name":"addToRequest","isAbstract":false,"isInherited":false,"header":"IRequest addToRequest(IRequest request, Json[string] extraCookies = null)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"cookies.byKeyValue.each!((kv)","name":"","isAbstract":false,"isInherited":false,"header":"cookies.byKeyValue.each!((kv)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (size > 4096)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (cookiePairs.isEmpty()","isStatic":false},{"isProperty":false,"parameters":["string hhtpScheme","string hostToMatch","string pathToMatch"],"datatype":"protected","name":"Json[string] findMatchingCookies","isAbstract":false,"isInherited":false,"header":"protected Json[string] findMatchingCookies(string hhtpScheme, string hostToMatch, string pathToMatch)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"foreach","name":"","isAbstract":false,"isInherited":false,"header":"foreach (cookie; _cookies)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (hhtpScheme == \"http\" && cookie.isSecure())","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!pathToMatch.startWith(cookie.getPath()))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (domain.startWith(\".\"))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (cookie.isExpired(now))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!preg_match(pattern, hostToMatch))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"addFromResponse(IResponse","name":"","isAbstract":false,"isInherited":false,"header":"addFromResponse(IResponse response, IRequest request)","isStatic":true},{"isProperty":false,"parameters":[],"datatype":"foreach","name":"","isAbstract":false,"isInherited":false,"header":"foreach (cookie; cookies)","isStatic":false},{"isProperty":false,"parameters":["string hostToCheck","string pathToCheck"],"datatype":"protected","name":"void removeExpiredCookies","isAbstract":false,"isInherited":false,"header":"protected void removeExpiredCookies(string hostToCheck, string pathToCheck)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"foreach","name":"","isAbstract":false,"isInherited":false,"header":"foreach (index: cookie; _cookies)","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (!cookie.isExpired(time))","isStatic":false},{"isProperty":false,"parameters":[],"datatype":"if","name":"","isAbstract":false,"isInherited":false,"header":"if (somePathMatches && hostMatches)","isStatic":false}]</td></tr><tr><td>type:class</td></tr></table>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- About section one-->
            <section class="py-5 bg-light" id="scroll-target">
                <div class="container px-5 my-5">
                </div>
            </section>
        </main>
        <!-- Footer-->
        <footer class="bg-dark py-4 mt-auto">
    <div class="container px-5">
        <div class="row align-items-center justify-content-between flex-column flex-sm-row">
            <div class="col-auto"><div class="small m-0 text-white">Copyright &copy; 2015 - 2024 Ozan Nurettin Süel</div></div>
            <div class="col-auto">
                <a class="link-light small" href="#!">Privacy</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="#!">Terms</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="#!">Contact</a>
            </div>
        </div>
    </div>
</footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
